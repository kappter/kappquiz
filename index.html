<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Quiz System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        select, input, button {
            padding: 10px;
            margin: 10px 0;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #quizArea, #results {
            margin-top: 20px;
        }
        .question {
            margin-bottom: 20px;
        }
        .option {
            display: block;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border: 1px solid #ddd;
            cursor: pointer;
            border-radius: 4px;
        }
        .option:hover {
            background: #e9ecef;
        }
        .correct {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .incorrect {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        .pagination {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        #progress {
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container" id="teacherPage" style="display: none;">
        <h1>Teacher Dashboard</h1>
        <h2>Upload Vocabulary CSV</h2>
        <input type="file" id="csvFile" accept=".csv">
        <button onclick="uploadCSV()">Upload</button>
    </div>

    <div class="container" id="studentPage">
        <h1>Student Vocabulary Quiz</h1>
        <h2>Select Vocabulary Set</h2>
        <select id="vocabSet" onchange="loadVocabSet()">
            <option value="">Select a set</option>
        </select>
        <div id="progress"></div>
        <div id="quizArea"></div>
        <div id="results"></div>
        <div class="pagination">
            <button onclick="prevQuestion()" disabled id="prevBtn">Previous</button>
            <button onclick="nextQuestion()" disabled id="nextBtn">Next</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        let vocabSets = [];
        let currentSet = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let answers = [];
        let questions = [];

        // Toggle between teacher and student pages (for demo; in production, separate files)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('mode') === 'teacher') {
            document.getElementById('teacherPage').style.display = 'block';
            document.getElementById('studentPage').style.display = 'none';
        } else {
            fetchVocabSets();
        }

        // Teacher: Upload CSV
        async function uploadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a CSV file.');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                if (response.ok) {
                    alert('CSV uploaded successfully!');
                    fileInput.value = '';
                } else {
                    alert('Upload failed.');
                }
            } catch (error) {
                console.error('Upload error:', error);
                alert('Upload failed.');
            }
        }

        // Student: Fetch available vocab sets
        async function fetchVocabSets() {
            try {
                const response = await fetch('/vocab-sets');
                const sets = await response.json();
                const select = document.getElementById('vocabSet');
                select.innerHTML = '<option value="">Select a set</option>';
                sets.forEach(set => {
                    const option = document.createElement('option');
                    option.value = set;
                    option.textContent = set.replace('.csv', '');
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching vocab sets:', error);
            }
        }

        // Student: Load selected vocab set
        async function loadVocabSet() {
            const select = document.getElementById('vocabSet');
            const setName = select.value;
            if (!setName) {
                document.getElementById('quizArea').innerHTML = '';
                document.getElementById('progress').innerHTML = '';
                document.getElementById('results').innerHTML = '';
                return;
            }

            try {
                const response = await fetch(`/vocab/${setName}`);
                const csvText = await response.text();
                Papa.parse(csvText, {
                    header: true,
                    complete: (result) => {
                        currentSet = result.data;
                        startQuiz();
                    }
                });
            } catch (error) {
                console.error('Error loading vocab set:', error);
            }
        }

        // Start quiz with randomized questions
        function startQuiz() {
            questions = generateQuestions(currentSet);
            currentQuestionIndex = 0;
            score = 0;
            answers = [];
            document.getElementById('results').innerHTML = '';
            displayQuestion();
            updateProgress();
            document.getElementById('prevBtn').disabled = true;
            document.getElementById('nextBtn').disabled = false;
        }

        // Generate multiple-choice questions
        function generateQuestions(data) {
            const questions = [];
            data.forEach(item => {
                if (!item.term || !item.definition) return;
                const incorrect = [];
                while (incorrect.length < 3) {
                    const randomItem = data[Math.floor(Math.random() * data.length)];
                    if (randomItem.definition !== item.definition && !incorrect.includes(randomItem.definition)) {
                        incorrect.push(randomItem.definition);
                    }
                }
                const options = [...incorrect, item.definition].sort(() => Math.random() - 0.5);
                questions.push({
                    term: item.term,
                    correct: item.definition,
                    options,
                    strand: item.strand
                });
            });
            return questions.sort(() => Math.random() - 0.5).slice(0, Math.min(10, questions.length));
        }

        // Display current question
        function displayQuestion() {
            const quizArea = document.getElementById('quizArea');
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }

            const question = questions[currentQuestionIndex];
            quizArea.innerHTML = `
                <div class="question">
                    <h3>Question ${currentQuestionIndex + 1}: What is the definition of "${question.term}"?</h3>
                    ${question.options.map((option, i) => `
                        <div class="option" onclick="selectOption(${i})">${option}</div>
                    `).join('')}
                </div>
            `;
        }

        // Handle option selection
        function selectOption(index) {
            const question = questions[currentQuestionIndex];
            const selected = question.options[index];
            const isCorrect = selected === question.correct;
            if (isCorrect) score++;
            answers.push({ term: question.term, selected, correct: question.correct, isCorrect });

            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.classList.add(question.options[i] === question.correct ? 'correct' : 'incorrect');
                opt.onclick = null;
            });

            setTimeout(() => {
                if (currentQuestionIndex < questions.length - 1) {
                    document.getElementById('nextBtn').disabled = false;
                } else {
                    showResults();
                }
            }, 500);
        }

        // Update progress percentage
        function updateProgress() {
            const percentage = Math.round((score / (currentQuestionIndex + 1)) * 100) || 0;
            document.getElementById('progress').innerHTML = `Current Score: ${percentage}%`;
        }

        // Navigate to previous question
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            }
        }

        // Navigate to next question
        function nextQuestion() {
            if (currentQuestionIndex < questions.length) {
                currentQuestionIndex++;
                displayQuestion();
                updateProgress();
                document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
                document.getElementById('nextBtn').disabled = currentQuestionIndex >= questions.length;
            }
        }

        // Show final results and report generation
        function showResults() {
            const percentage = Math.round((score / questions.length) * 100);
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h2>Quiz Completed!</h2>
                <p>Final Score: ${score}/${questions.length} (${percentage}%)</p>
                <input type="text" id="studentName" placeholder="Enter your name">
                <button onclick="generateReport()">Generate Report</button>
            `;
            document.getElementById('quizArea').innerHTML = '';
            document.getElementById('progress').innerHTML = '';
            document.getElementById('nextBtn').disabled = true;
        }

        // Generate HTML report
        function generateReport() {
            const studentName = document.getElementById('studentName').value || 'Student';
            const percentage = Math.round((score / questions.length) * 100);
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                <head>
                    <title>Quiz Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background: #f4f4f9; }
                        .correct { color: green; }
                        .incorrect { color: red; }
                    </style>
                </head>
                <body>
                    <h1>Vocabulary Quiz Report</h1>
                    <p><strong>Student:</strong> ${studentName}</p>
                    <p><strong>Score:</strong> ${score}/${questions.length} (${percentage}%)</p>
                    <table>
                        <tr>
                            <th>Term</th>
                            <th>Your Answer</th>
                            <th>Correct Answer</th>
                            <th>Result</th>
                            <th>Strand</th>
                        </tr>
                        ${answers.map(answer => `
                            <tr>
                                <td>${answer.term}</td>
                                <td>${answer.selected}</td>
                                <td>${answer.correct}</td>
                                <td class="${answer.isCorrect ? 'correct' : 'incorrect'}">${answer.isCorrect ? 'Correct' : 'Incorrect'}</td>
                                <td>${questions.find(q => q.term === answer.term).strand}</td>
                            </tr>
                        `).join('')}
                    </table>
                    <button onclick="window.print()">Print Report</button>
                </body>
                </html>
            `);
            reportWindow.document.close();
        }
    </script>
</body>
</html>

<xaiArtifact artifact_id="0873cf77-af51-486d-90b9-7ec1bbcc852b" artifact_version_id="8f4b7e3f-e4ef-4e98-9955-dd2c7f231153" title="server.js" contentType="text/javascript">
const express = require('express');
const multer = require('multer');
const fs = require('fs');
const path = require('path');
const app = express();
const port = 3000;

const upload = multer({ dest: 'uploads/' });

app.use(express.static(__dirname));

app.get('/vocab-sets', (req, res) => {
    fs.readdir('uploads', (err, files) => {
        if (err) {
            res.status(500).send('Error reading uploads>
            return;
        }
        const csvFiles = files.filter(file => file.endsWith('.csv'));
        res.json(csvFiles);
    });
});

app.get('/vocab/:setName', (req, res) => {
    const filePath = path.join(__dirname, 'uploads', req.params.setName);
    if (fs.existsSync(filePath)) {
        res.sendFile(filePath);
    } else {
        res.status(404).send('File not found');
    }
});

app.post('/upload', upload.single('file'), (req, res) => {
    if (!req.file) {
        return res.status(400).send('No file uploaded.');
    }
    const newPath = path.join(__dirname, 'uploads', req.file.originalname);
    fs.renameSync(req.file.path, newPath);
    res.send('File uploaded successfully.');
});

app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
});